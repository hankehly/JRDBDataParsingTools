models:
  - name: stg_jrdb__bac
    columns:
      # derived
      - name: レースキー
        tests:
          - not_null
      # original
      - name: レースキー_場コード
        tests:
          - not_null
          - relationships:
              to: ref('場コード')
              field: code
      - name: レースキー_年
        tests:
          - not_null
      - name: レースキー_回
        tests:
          - not_null
      - name: レースキー_日
        tests:
          - not_null
      - name: レースキー_Ｒ
        tests:
          - not_null
      - name: 年月日
        tests:
          - not_null
      - name: 発走時間
        tests:
          - not_null
      - name: レース条件_距離
        tests:
          - not_null
      - name: レース条件_トラック情報_芝ダ障害コード
        tests:
          - not_null
          - accepted_values:
              values: [1, 2, 3]
      - name: レース条件_トラック情報_右左
        tests:
          - not_null
          - accepted_values:
              values: [1, 2, 3, 9]
      - name: レース条件_トラック情報_内外
        tests:
          - not_null
          - accepted_values:
              values: [1, 2, 3, 9]
      - name: レース条件_種別
        tests:
          - not_null
      - name: レース条件_条件
        tests:
          - not_null
      - name: レース条件_記号
        tests:
          - not_null
          # - relationships:
          #     to: ref('特記コード')
          #     field: コード
      - name: レース条件_重量
        tests:
          - not_null
      - name: レース条件_グレード
      - name: レース名
      - name: 回数
      - name: 頭数
        tests:
          - not_null
      - name: コース
        tests:
          - accepted_values:
              values: [1, 2, 3, 4, 5, 6]
      - name: 開催区分
        tests:
          - not_null
          - accepted_values:
              values: [1, 2, 3]
      - name: レース名短縮
      - name: レース名９文字
        tests:
          - not_null
      - name: データ区分
        tests:
          - not_null
      - name: １着賞金
        tests:
          - not_null
      - name: ２着賞金
        tests:
          - not_null
      - name: ３着賞金
        tests:
          - not_null
      - name: ４着賞金
        tests:
          - not_null
      - name: ５着賞金
        tests:
          - not_null
      - name: １着算入賞金
        tests:
          - not_null
      - name: ２着算入賞金
        tests:
          - not_null
      - name: 馬券発売フラグ_単勝
        tests:
          - not_null
      - name: 馬券発売フラグ_複勝
        tests:
          - not_null
      - name: 馬券発売フラグ_枠連
        tests:
          - not_null
      - name: 馬券発売フラグ_馬連
        tests:
          - not_null
      - name: 馬券発売フラグ_馬単
        tests:
          - not_null
      - name: 馬券発売フラグ_ワイド
        tests:
          - not_null
      - name: 馬券発売フラグ_３連複
        tests:
          - not_null
      - name: 馬券発売フラグ_３連単
        tests:
          - not_null
      - name: WIN5フラグ

  - name: stg_jrdb__cha
    columns:
      # derived
      - name: レースキー
        tests:
          - not_null
      # original
      - name: レースキー_場コード
        tests:
          - not_null
          - relationships:
              to: ref('場コード')
              field: code
      - name: レースキー_年
        tests:
          - not_null
      - name: レースキー_回
        tests:
          - not_null
      - name: レースキー_日
        tests:
          - not_null
      - name: レースキー_Ｒ
        tests:
          - not_null
      - name: 馬番
        tests:
          - not_null
      - name: 曜日
        tests:
          - not_null
      - name: 調教年月日
        tests:
          - not_null
      - name: 回数
        tests:
          - not_null
      - name: 調教コースコード # there's only 1 null value in the whole dataset..
        tests:
          - relationships:
              to: ref('調教コースコード')
              field: コード
      - name: 追切種類
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 追い状態
        tests:
          - relationships:
              to: ref('追い状態コード')
              field: コード
      - name: 乗り役
        tests:
          - accepted_values:
              values: [1, 2, 3, 4, 5]
      - name: 調教Ｆ
        tests:
          - not_null
      - name: 時計分析データ_テンＦ
      - name: 時計分析データ_中間Ｆ
      - name: 時計分析データ_終いＦ
      - name: 時計分析データ_テンＦ指数
      - name: 時計分析データ_中間Ｆ指数
      - name: 時計分析データ_終いＦ指数
      - name: 時計分析データ_追切指数
      - name: 併せ馬相手データ_併せ結果
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 併せ馬相手データ_追切種類
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 併せ馬相手データ_年齢
      - name: 併せ馬相手データ_クラス
        tests:
          - relationships:
              to: ref('条件コード')
              field: code

  - name: stg_jrdb__cyb
    columns:
      # derived
      - name: レースキー
        tests:
          - not_null
      # original
      - name: レースキー_場コード
        tests:
          - not_null
          - relationships:
              to: ref('場コード')
              field: code
      - name: レースキー_年
        tests:
          - not_null
      - name: レースキー_回
        tests:
          - not_null
      - name: レースキー_日
        tests:
          - not_null
      - name: レースキー_Ｒ
        tests:
          - not_null
      - name: 馬番
        tests:
          - not_null
      - name: 調教タイプ # ??
      - name: 調教コース種別 # ??
        tests:
          - not_null
          - accepted_values:
              values: [0, 1, 2, 3, 4, 5]
      - name: 調教コース種類_坂
        tests:
          - not_null
      - name: 調教コース種類_Ｗ
        tests:
          - not_null
      - name: 調教コース種類_ダ
        tests:
          - not_null
      - name: 調教コース種類_芝
        tests:
          - not_null
      - name: 調教コース種類_プ
        tests:
          - not_null
      - name: 調教コース種類_障
        tests:
          - not_null
      - name: 調教コース種類_ポ
        tests:
          - not_null
      - name: 調教距離
        tests:
          - not_null
          - accepted_values:
              values: [0, 1, 2, 3, 4]
      - name: 調教重点
        tests:
          - not_null
          - accepted_values:
              values: [0, 1, 2, 3, 4]
      - name: 追切指数
      - name: 仕上指数
      - name: 調教量評価 # ?? where are these codes coming from
        description: A,B,C,Dに分類 (コード等の詳細説明は、【調教分析データ内容の説明】を参照してください。)
        tests:
          - accepted_values:
              values: ["A", "B", "C", "D"]
      - name: 仕上指数変化 # ?? where are these codes coming from
        tests:
          - accepted_values:
              values: [0, 1, 2, 3, 4]
      - name: 調教コメント
      - name: コメント年月日
      - name: 調教評価
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 一週前追切指数
      - name: 一週前追切コース
        description: 一週前追切の調教の追切コース (コード等の詳細説明は、【調教分析データ内容の説明】を参照してください。)
        tests:
          - relationships:
              to: ref('調教コースコード')
              field: コード
  - name: stg_jrdb__hjc
    columns:
      # derived
      - name: レースキー
        tests:
          - not_null
      # original
      - name: レースキー_場コード
        tests:
          - not_null
          - relationships:
              to: ref('場コード')
              field: code
      - name: レースキー_年
        tests:
          - not_null
      - name: レースキー_回
        tests:
          - not_null
      - name: レースキー_日
        tests:
          - not_null
      - name: レースキー_Ｒ
        tests:
          - not_null
      - name: 単勝払戻
        tests:
          - not_null
      - name: 複勝払戻
        tests:
          - not_null
      - name: 枠連払戻
        tests:
          - not_null
      - name: 馬連払戻
        tests:
          - not_null
      - name: ワイド払戻
        tests:
          - not_null
      - name: 馬単払戻
        tests:
          - not_null
      - name: ３連複払戻
        tests:
          - not_null
      - name: ３連単払戻
        tests:
          - not_null
  - name: stg_jrdb__kab
    columns:
      # derived
      - name: 開催キー
        tests:
          - not_null
      # original
      - name: 開催キー_場コード
        tests:
          - not_null
          - relationships:
              to: ref('場コード')
              field: code
      - name: 開催キー_年
        tests:
          - not_null
      - name: 開催キー_回
        tests:
          - not_null
      - name: 開催キー_日
        tests:
          - not_null
      - name: 年月日
        tests:
          - not_null
      - name: 開催区分
        tests:
          - not_null
          - accepted_values:
              values: [1, 2, 3]
      - name: 曜日
        tests:
          - not_null
          - accepted_values:
              values: ["月", "火", "水", "木", "金", "土", "日"]
      - name: 場名
      - name: 天候コード
        tests:
          - relationships:
              to: ref('天候コード')
              field: code

      - name: 芝馬場状態コード
        tests:
          - not_null
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: 芝馬場状態内
        tests:
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: 芝馬場状態中
        tests:
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: 芝馬場状態外
        tests:
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: 芝馬場差
      - name: 直線馬場差最内
      - name: 直線馬場差内
      - name: 直線馬場差中
      - name: 直線馬場差外
      - name: 直線馬場差大外
      - name: ダ馬場状態コード
        tests:
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: ダ馬場状態内
        tests:
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: ダ馬場状態中
        tests:
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: ダ馬場状態外
        tests:
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: ダ馬場差
      - name: データ区分
        tests:
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: 連続何日目
        tests:
          - not_null
      - name: 芝種類
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 草丈
      - name: 転圧
      - name: 凍結防止剤
      - name: 中間降水量

  - name: stg_jrdb__kyi
    columns:
      # derived
      - name: レースキー
        tests:
          - not_null
      # original
      - name: レースキー_場コード
        tests:
          - not_null
          - relationships:
              to: ref('場コード')
              field: code
      - name: レースキー_年
        tests:
          - not_null
      - name: レースキー_回
        tests:
          - not_null
      - name: レースキー_日
        tests:
          - not_null
      - name: レースキー_Ｒ
        tests:
          - not_null
      - name: 馬番
        tests:
          - not_null
      - name: 血統登録番号
        tests:
          - not_null
      - name: 馬名
        tests:
          - not_null
      - name: ＩＤＭ
        tests:
          - not_null
      - name: 騎手指数
        tests:
          - not_null
      - name: 情報指数
        tests:
          - not_null
      - name: 総合指数
        tests:
          - not_null
      - name: 脚質 # ?? values 1-9 what do they mean?
      - name: 距離適性 # ?? same here
      - name: 上昇度 # ?? same
      - name: ローテーション
      - name: 基準オッズ
        tests:
          - not_null
      - name: 基準人気順位
        tests:
          - not_null
      - name: 基準複勝オッズ
        tests:
          - not_null
      - name: 基準複勝人気順位
        tests:
          - not_null
      - name: 特定情報◎
        tests:
          - not_null
      - name: 特定情報○
        tests:
          - not_null
      - name: 特定情報▲
        tests:
          - not_null
      - name: 特定情報△
        tests:
          - not_null
      - name: 特定情報× # has nulls, not sure if safe to coalesce to 0
      - name: 総合情報◎
        tests:
          - not_null
      - name: 総合情報○
        tests:
          - not_null
      - name: 総合情報▲
        tests:
          - not_null
      - name: 総合情報△
        tests:
          - not_null
      - name: 総合情報× # has nulls, not sure if safe to coalesce to 0
      - name: 人気指数
        tests:
          - not_null
      - name: 調教指数 # 3000 records with nulls, can this be coalesced?
      - name: 厩舎指数
        tests:
          - not_null
      - name: 調教矢印コード # only 2 nulls from 1999, replacing with most common value
        tests:
          - not_null
          - relationships:
              to: ref('調教矢印コード')
              field: code
      - name: 厩舎評価コード
        tests:
          - not_null
          - relationships:
              to: ref('厩舎評価コード')
              field: code
      - name: 騎手期待連対率
        tests:
          - not_null
      - name: 激走指数
        tests:
          - not_null
      - name: 蹄コード
        tests:
          - relationships:
              to: ref('蹄コード')
              field: code
      - name: 重適性コード # fixed 正→性 naming mistake
        tests:
          - relationships:
              to: ref('重適性コード')
              field: code
      - name: クラスコード
        tests:
          - relationships:
              to: ref('クラスコード')
              field: code
      - name: ブリンカー
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 騎手名
        tests:
          - not_null
      - name: 負担重量
        tests:
          - not_null
      - name: 見習い区分
        tests:
          - accepted_values:
              values: [1, 2, 3, 4, 9]
      - name: 調教師名
        tests:
          - not_null
      - name: 調教師所属 # only like 6 null rows

      # Todo: these should relate to SED/SKB 競走成績キー
      - name: 他データリンク用キー_前走１競走成績キー
      - name: 他データリンク用キー_前走２競走成績キー
      - name: 他データリンク用キー_前走３競走成績キー
      - name: 他データリンク用キー_前走４競走成績キー
      - name: 他データリンク用キー_前走５競走成績キー

      # Todo: these should relate SED also?
      - name: 他データリンク用キー_前走１レースキー
      - name: 他データリンク用キー_前走２レースキー
      - name: 他データリンク用キー_前走３レースキー
      - name: 他データリンク用キー_前走４レースキー
      - name: 他データリンク用キー_前走５レースキー

      - name: 枠番
        tests:
          - not_null
      - name: 印コード_総合印
        tests:
          - relationships:
              to: ref('印コード')
              field: code
      - name: 印コード_ＩＤＭ印
        tests:
          - relationships:
              to: ref('印コード')
              field: code
      - name: 印コード_情報印
        tests:
          - relationships:
              to: ref('印コード')
              field: code
      - name: 印コード_騎手印
        tests:
          - relationships:
              to: ref('印コード')
              field: code
      - name: 印コード_厩舎印
        tests:
          - relationships:
              to: ref('印コード')
              field: code
      - name: 印コード_調教印
        tests:
          - relationships:
              to: ref('印コード')
              field: code
      - name: 印コード_激走印
        tests:
          - not_null
      - name: 芝適性コード
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: ダ適性コード
        tests:
          - accepted_values:
              values: [1, 2, 3]

      # todo
      - name: 騎手コード
        description: 騎手マスタとリンク

      # todo
      - name: 調教師コード
        description: 調教師マスタとリンク

      - name: 賞金情報_獲得賞金
        tests:
          - not_null
      - name: 賞金情報_収得賞金
        tests:
          - not_null
      - name: 賞金情報_条件クラス
        tests:
          - not_null
          - relationships:
              to: ref('条件コード')
              field: group_code
      - name: 展開予想データ_テン指数
      - name: 展開予想データ_ペース指数
      - name: 展開予想データ_上がり指数
      - name: 展開予想データ_位置指数
      - name: 展開予想データ_ペース予想
      - name: 展開予想データ_道中順位
      - name: 展開予想データ_道中差
      - name: 展開予想データ_道中内外
        tests:
          - accepted_values:
              values: [2, 3, 4, 5]
      - name: 展開予想データ_後３Ｆ順位
      - name: 展開予想データ_後３Ｆ差
      - name: 展開予想データ_後３Ｆ内外
        tests:
          - accepted_values:
              values: [2, 3, 4, 5]
      - name: 展開予想データ_ゴール順位
      - name: 展開予想データ_ゴール差
      - name: 展開予想データ_ゴール内外
        tests:
          - accepted_values:
              values: [1, 2, 3, 4, 5]
      - name: 展開予想データ_展開記号
        tests:
          - relationships:
              to: ref('展開記号コード')
              field: code

      # you are here
      - name: 距離適性２
      - name: 枠確定馬体重
        description: データ無:スペース
      - name: 枠確定馬体重増減
        description: 符号+数字２桁,データ無:スペース
      - name: 取消フラグ
        description: 1:取消
      - name: 性別コード
        description: 1:牡,2:牝,3,セン
      - name: 馬主名
        description: 全角２０文字
      - name: 馬主会コード
        description: 参考データ。"00":無所属,スペース:不明
      - name: 馬記号コード
        description: コード表参照
      - name: 激走順位
        description: レース出走馬中での順位
      - name: LS指数順位
      - name: テン指数順位
      - name: ペース指数順位
      - name: 上がり指数順位
      - name: 位置指数順位
      - name: 騎手期待単勝率
      - name: 騎手期待３着内率
      - name: 輸送区分
      - name: 走法
        description: コード表参照
      - name: 体型
        description: コード表参照
      - name: 体型総合１
        description: 特記コード参照
      - name: 体型総合２
        description: 特記コード参照
      - name: 体型総合３
        description: 特記コード参照
      - name: 馬特記１
        description: 特記コード参照
      - name: 馬特記２
        description: 特記コード参照
      - name: 馬特記３
        description: 特記コード参照
      - name: 展開参考データ_馬スタート指数
      - name: 展開参考データ_馬出遅率
      - name: 展開参考データ_参考前走
        description: 参考となる前走（２走分格納）
      - name: 展開参考データ_参考前走騎手コード
        description: 参考となる前走の騎手
      - name: 万券指数
      - name: 万券印
      - name: 降級フラグ
        description: 1:降級, 2:２段階降級, 0:通常
      - name: 激走タイプ
        description: 激走馬のタイプ分け。説明参照
      - name: 休養理由分類コード
        description: コード表参照
      - name: フラグ
        description: 初芝初ダ初障などのフラグ。内容説明参照
      - name: 入厩何走目
        description: 例）2:入厩後２走目
      - name: 入厩年月日
        description: YYYYMMDD
      - name: 入厩何日前
        description: レース日から遡っての入厩の日数（今走前に入厩の場合）
      - name: 放牧先
        description: 放牧先/近走放牧先
      - name: 放牧先ランク
        description: A-E
      - name: 厩舎ランク
        description: 高い1-9低い 内容説明参照
