models:
  - name: stg_jrdb__bac
    columns:
      # derived
      - name: レースキー
        tests:
          - not_null
      - name: 開催キー
        tests:
          - not_null
      # original
      - name: レースキー_場コード
        tests:
          - not_null
          - relationships:
              to: ref('場コード')
              field: code
      - name: レースキー_年
        tests:
          - not_null
      - name: レースキー_回
        tests:
          - not_null
      - name: レースキー_日
        tests:
          - not_null
      - name: レースキー_Ｒ
        tests:
          - not_null
      - name: 年月日
        tests:
          - not_null
      - name: 発走時間
        tests:
          - not_null
      - name: レース条件_距離
        tests:
          - not_null
      - name: レース条件_トラック情報_芝ダ障害コード
        tests:
          - not_null
          - accepted_values:
              values: ['芝', 'ダート', '障害']
      - name: レース条件_トラック情報_右左
        tests:
          - not_null
          - accepted_values:
              values: [1, 2, 3, 9]
      - name: レース条件_トラック情報_内外
        tests:
          - not_null
          - accepted_values:
              values: [1, 2, 3, 9]
      - name: レース条件_種別
        tests:
          - not_null
      - name: レース条件_条件
        tests:
          - not_null
      - name: レース条件_記号
        tests:
          - not_null
          # - relationships:
          #     to: ref('特記コード')
          #     field: コード
      - name: レース条件_重量
        tests:
          - not_null
      - name: レース条件_グレード
      - name: レース名
      - name: 回数
      - name: 頭数
        tests:
          - not_null
      - name: コース
        tests:
          - accepted_values:
              values: [1, 2, 3, 4, 5, 6]
      - name: 開催区分
        tests:
          - not_null
          - accepted_values:
              values: [1, 2, 3]
      - name: レース名短縮
      - name: レース名９文字
        tests:
          - not_null
      - name: データ区分
        tests:
          - not_null
      - name: １着賞金
        tests:
          - not_null
      - name: ２着賞金
        tests:
          - not_null
      - name: ３着賞金
        tests:
          - not_null
      - name: ４着賞金
        tests:
          - not_null
      - name: ５着賞金
        tests:
          - not_null
      - name: １着算入賞金
        tests:
          - not_null
      - name: ２着算入賞金
        tests:
          - not_null
      - name: 馬券発売フラグ_単勝
        tests:
          - not_null
      - name: 馬券発売フラグ_複勝
        tests:
          - not_null
      - name: 馬券発売フラグ_枠連
        tests:
          - not_null
      - name: 馬券発売フラグ_馬連
        tests:
          - not_null
      - name: 馬券発売フラグ_馬単
        tests:
          - not_null
      - name: 馬券発売フラグ_ワイド
        tests:
          - not_null
      - name: 馬券発売フラグ_３連複
        tests:
          - not_null
      - name: 馬券発売フラグ_３連単
        tests:
          - not_null
      - name: WIN5フラグ

  - name: stg_jrdb__cha
    columns:
      # derived
      - name: レースキー
        tests:
          - not_null
      - name: 開催キー
        tests:
          - not_null
      # original
      - name: レースキー_場コード
        tests:
          - not_null
          - relationships:
              to: ref('場コード')
              field: code
      - name: レースキー_年
        tests:
          - not_null
      - name: レースキー_回
        tests:
          - not_null
      - name: レースキー_日
        tests:
          - not_null
      - name: レースキー_Ｒ
        tests:
          - not_null
      - name: 馬番
        tests:
          - not_null
      - name: 曜日
        tests:
          - not_null
      - name: 調教年月日
        tests:
          - not_null
      - name: 回数
        tests:
          - not_null
      - name: 調教コースコード # there's only 1 null value in the whole dataset..
        tests:
          - relationships:
              to: ref('調教コースコード')
              field: コード
      - name: 追切種類
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 追い状態
        tests:
          - relationships:
              to: ref('追い状態コード')
              field: コード
      - name: 乗り役
        tests:
          - accepted_values:
              values: [1, 2, 3, 4, 5]
      - name: 調教Ｆ
        tests:
          - not_null
      - name: 時計分析データ_テンＦ
      - name: 時計分析データ_中間Ｆ
      - name: 時計分析データ_終いＦ
      - name: 時計分析データ_テンＦ指数
      - name: 時計分析データ_中間Ｆ指数
      - name: 時計分析データ_終いＦ指数
      - name: 時計分析データ_追切指数
      - name: 併せ馬相手データ_併せ結果
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 併せ馬相手データ_追切種類
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 併せ馬相手データ_年齢
      - name: 併せ馬相手データ_クラス
        tests:
          - relationships:
              to: ref('条件コード')
              field: code

  - name: stg_jrdb__cyb
    columns:
      # derived
      - name: レースキー
        tests:
          - not_null
      - name: 開催キー
        tests:
          - not_null
      # original
      - name: レースキー_場コード
        tests:
          - not_null
          - relationships:
              to: ref('場コード')
              field: code
      - name: レースキー_年
        tests:
          - not_null
      - name: レースキー_回
        tests:
          - not_null
      - name: レースキー_日
        tests:
          - not_null
      - name: レースキー_Ｒ
        tests:
          - not_null
      - name: 馬番
        tests:
          - not_null
      - name: 調教タイプ # ??
      - name: 調教コース種別 # ??
        tests:
          - not_null
          - accepted_values:
              values: [0, 1, 2, 3, 4, 5]
      - name: 調教コース種類_坂
        tests:
          - not_null
      - name: 調教コース種類_Ｗ
        tests:
          - not_null
      - name: 調教コース種類_ダ
        tests:
          - not_null
      - name: 調教コース種類_芝
        tests:
          - not_null
      - name: 調教コース種類_プ
        tests:
          - not_null
      - name: 調教コース種類_障
        tests:
          - not_null
      - name: 調教コース種類_ポ
        tests:
          - not_null
      - name: 調教距離
        tests:
          - not_null
          - accepted_values:
              values: [0, 1, 2, 3, 4]
      - name: 調教重点
        tests:
          - not_null
          - accepted_values:
              values: [0, 1, 2, 3, 4]
      - name: 追切指数
      - name: 仕上指数
      - name: 調教量評価
        description: A,B,C,Dに分類 (コード等の詳細説明は、【調教分析データ内容の説明】を参照してください。)
        tests:
          - accepted_values:
              values: ["A", "B", "C", "D"]
      - name: 仕上指数変化
        tests:
          - accepted_values:
              values: [0, 1, 2, 3, 4]
      - name: 調教コメント
      - name: コメント年月日
      - name: 調教評価
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 一週前追切指数
      - name: 一週前追切コース
        description: 一週前追切の調教の追切コース (コード等の詳細説明は、【調教分析データ内容の説明】を参照してください。)
        tests:
          - relationships:
              to: ref('調教コースコード')
              field: コード
  - name: stg_jrdb__hjc
    columns:
      # derived
      - name: レースキー
        tests:
          - not_null
      - name: 開催キー
        tests:
          - not_null
      # original
      - name: レースキー_場コード
        tests:
          - not_null
          - relationships:
              to: ref('場コード')
              field: code
      - name: レースキー_年
        tests:
          - not_null
      - name: レースキー_回
        tests:
          - not_null
      - name: レースキー_日
        tests:
          - not_null
      - name: レースキー_Ｒ
        tests:
          - not_null
      - name: 単勝払戻
        tests:
          - not_null
      - name: 複勝払戻
        tests:
          - not_null
      - name: 枠連払戻
        tests:
          - not_null
      - name: 馬連払戻
        tests:
          - not_null
      - name: ワイド払戻
        tests:
          - not_null
      - name: 馬単払戻
        tests:
          - not_null
      - name: ３連複払戻
        tests:
          - not_null
      - name: ３連単払戻
        tests:
          - not_null
  - name: stg_jrdb__kab
    columns:
      # derived
      - name: 開催キー
        tests:
          - not_null
      # original
      - name: 開催キー_場コード
        tests:
          - not_null
          - relationships:
              to: ref('場コード')
              field: code
      - name: 開催キー_年
        tests:
          - not_null
      - name: 開催キー_回
        tests:
          - not_null
      - name: 開催キー_日
        tests:
          - not_null
      - name: 年月日
        tests:
          - not_null
      - name: 開催区分
        tests:
          - not_null
          - accepted_values:
              values: [1, 2, 3]
      - name: 曜日
        tests:
          - not_null
          - accepted_values:
              values: ["月", "火", "水", "木", "金", "土", "日"]
      - name: 場名
      - name: 天候コード
        tests:
          - relationships:
              to: ref('天候コード')
              field: code

      - name: 芝馬場状態コード
        tests:
          - not_null
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: 芝馬場状態内
        tests:
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: 芝馬場状態中
        tests:
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: 芝馬場状態外
        tests:
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: 芝馬場差
      - name: 直線馬場差最内
      - name: 直線馬場差内
      - name: 直線馬場差中
      - name: 直線馬場差外
      - name: 直線馬場差大外
      - name: ダ馬場状態コード
        tests:
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: ダ馬場状態内
        tests:
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: ダ馬場状態中
        tests:
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: ダ馬場状態外
        tests:
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: ダ馬場差
      - name: データ区分
        tests:
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: 連続何日目
        tests:
          - not_null
      - name: 芝種類
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 草丈
      - name: 転圧
      - name: 凍結防止剤
      - name: 中間降水量

  - name: stg_jrdb__kyi
    columns:
      # derived
      - name: レースキー
        tests:
          - not_null
      - name: 開催キー
        tests:
          - not_null
      # original
      - name: レースキー_場コード
        tests:
          - not_null
          - relationships:
              to: ref('場コード')
              field: code
      - name: レースキー_年
        tests:
          - not_null
      - name: レースキー_回
        tests:
          - not_null
      - name: レースキー_日
        tests:
          - not_null
      - name: レースキー_Ｒ
        tests:
          - not_null
      - name: 馬番
        tests:
          - not_null
      - name: 血統登録番号
        tests:
          - not_null
      - name: 馬名
        tests:
          - not_null
      - name: ＩＤＭ
        tests:
          - not_null
      - name: 騎手指数
        tests:
          - not_null
      - name: 情報指数
        tests:
          - not_null
      - name: 総合指数
        tests:
          - not_null
      - name: 脚質 # ?? values 1-9 what do they mean?
      - name: 距離適性
        tests:
          - relationships:
              to: ref('距離適性コード')
              field: code
      - name: 上昇度
        tests:
          - relationships:
              to: ref('上昇度コード')
              field: code
      - name: ローテーション
      - name: 基準オッズ
        tests:
          - not_null
      - name: 基準人気順位
        tests:
          - not_null
      - name: 基準複勝オッズ
        tests:
          - not_null
      - name: 基準複勝人気順位
        tests:
          - not_null
      - name: 特定情報◎
        tests:
          - not_null
      - name: 特定情報○
        tests:
          - not_null
      - name: 特定情報▲
        tests:
          - not_null
      - name: 特定情報△
        tests:
          - not_null
      - name: 特定情報× # has nulls, not sure if safe to coalesce to 0
      - name: 総合情報◎
        tests:
          - not_null
      - name: 総合情報○
        tests:
          - not_null
      - name: 総合情報▲
        tests:
          - not_null
      - name: 総合情報△
        tests:
          - not_null
      - name: 総合情報× # has nulls, not sure if safe to coalesce to 0
      - name: 人気指数
        tests:
          - not_null
      - name: 調教指数 # 3000 records with nulls, can this be coalesced?
      - name: 厩舎指数
        tests:
          - not_null
      - name: 調教矢印コード # only 2 nulls from 1999, replacing with most common value
        tests:
          - not_null
          - relationships:
              to: ref('調教矢印コード')
              field: code
      - name: 厩舎評価コード
        tests:
          - not_null
          - relationships:
              to: ref('厩舎評価コード')
              field: code
      - name: 騎手期待連対率
        tests:
          - not_null
      - name: 激走指数
        tests:
          - not_null
      - name: 蹄コード
        tests:
          - relationships:
              to: ref('蹄コード')
              field: code
      - name: 重適性コード # fixed 正→性 naming mistake
        tests:
          - relationships:
              to: ref('重適性コード')
              field: code
      - name: クラスコード
        tests:
          - relationships:
              to: ref('クラスコード')
              field: code
      - name: ブリンカー
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 騎手名
        tests:
          - not_null
      - name: 負担重量
        tests:
          - not_null
      - name: 見習い区分
        tests:
          - accepted_values:
              values: [1, 2, 3, 4, 9]
      - name: 調教師名
        tests:
          - not_null
      - name: 調教師所属 # only like 6 null rows

      # Todo: these should relate to SED/SKB 競走成績キー
      - name: 他データリンク用キー_前走１競走成績キー
      - name: 他データリンク用キー_前走２競走成績キー
      - name: 他データリンク用キー_前走３競走成績キー
      - name: 他データリンク用キー_前走４競走成績キー
      - name: 他データリンク用キー_前走５競走成績キー

      # Todo: these should relate SED also?
      - name: 他データリンク用キー_前走１レースキー
      - name: 他データリンク用キー_前走２レースキー
      - name: 他データリンク用キー_前走３レースキー
      - name: 他データリンク用キー_前走４レースキー
      - name: 他データリンク用キー_前走５レースキー

      - name: 枠番
        tests:
          - not_null
      - name: 印コード_総合印
        tests:
          - relationships:
              to: ref('印コード')
              field: code
      - name: 印コード_ＩＤＭ印
        tests:
          - relationships:
              to: ref('印コード')
              field: code
      - name: 印コード_情報印
        tests:
          - relationships:
              to: ref('印コード')
              field: code
      - name: 印コード_騎手印
        tests:
          - relationships:
              to: ref('印コード')
              field: code
      - name: 印コード_厩舎印
        tests:
          - relationships:
              to: ref('印コード')
              field: code
      - name: 印コード_調教印
        tests:
          - relationships:
              to: ref('印コード')
              field: code
      - name: 印コード_激走印
        tests:
          - not_null
      - name: 芝適性コード
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: ダ適性コード
        tests:
          - accepted_values:
              values: [1, 2, 3]

      # todo
      - name: 騎手コード
        description: 騎手マスタとリンク

      # todo
      - name: 調教師コード
        description: 調教師マスタとリンク

      - name: 賞金情報_獲得賞金
        tests:
          - not_null
      - name: 賞金情報_収得賞金
        tests:
          - not_null
      - name: 賞金情報_条件クラス
        tests:
          - not_null
          - relationships:
              to: ref('条件コード')
              field: group_code
      - name: 展開予想データ_テン指数
      - name: 展開予想データ_ペース指数
      - name: 展開予想データ_上がり指数
      - name: 展開予想データ_位置指数
      - name: 展開予想データ_ペース予想
      - name: 展開予想データ_道中順位
      - name: 展開予想データ_道中差
      - name: 展開予想データ_道中内外
        tests:
          - accepted_values:
              values: [2, 3, 4, 5]
      - name: 展開予想データ_後３Ｆ順位
      - name: 展開予想データ_後３Ｆ差
      - name: 展開予想データ_後３Ｆ内外
        tests:
          - accepted_values:
              values: [2, 3, 4, 5]
      - name: 展開予想データ_ゴール順位
      - name: 展開予想データ_ゴール差
      - name: 展開予想データ_ゴール内外
        tests:
          - accepted_values:
              values: [1, 2, 3, 4, 5]
      - name: 展開予想データ_展開記号
        tests:
          - relationships:
              to: ref('展開記号コード')
              field: code
      - name: 距離適性２ # what does this field mean given we already have 距離適性?
        tests:
          - relationships:
              to: ref('距離適性コード')
              field: code
      - name: 枠確定馬体重

      # do null and 0 mean the same thing?
      - name: 枠確定馬体重増減

      - name: 取消フラグ
        tests:
          - not_null
      - name: 性別コード
        tests:
          - not_null
          - accepted_values:
              values: [1, 2, 3]
      - name: 馬主名
        tests:
          - not_null
      - name: 馬主会コード
      - name: 馬記号コード
        tests:
          - not_null
          - relationships:
              to: ref('馬記号コード')
              field: code
      - name: 激走順位
      - name: LS指数順位
      - name: テン指数順位
      - name: ペース指数順位
      - name: 上がり指数順位
      - name: 位置指数順位
      - name: 騎手期待単勝率
      - name: 騎手期待３着内率
      - name: 輸送区分
        tests:
          - not_null
          - accepted_values:
              values: [0, 1, 2, 3, 4]
      - name: 走法
        description: don't use, this field is no longer updated
      - name: 体型_全体
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 体型_背中
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 体型_胴
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 体型_尻
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 体型_トモ
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 体型_腹袋
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 体型_頭
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 体型_首
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 体型_胸
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 体型_肩
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 体型_前長
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 体型_後長
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 体型_前幅
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 体型_後幅
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 体型_前繋
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 体型_後繋
        tests:
          - accepted_values:
              values: [1, 2, 3]
        # 体型_尾 and 体型_振 contain mostly nulls and shouldn't be used
      - name: 体型_尾
      - name: 体型_振
      - name: 体型_予備1
      - name: 体型_予備2
      - name: 体型_予備3
      - name: 体型_予備4
      - name: 体型_予備5
      - name: 体型_予備6
      - name: 体型_予備7
      - name: 体型_予備8
      - name: 体型総合１
        tests:
          - relationships:
              to: ref('特記コード')
              field: コード
      - name: 体型総合２
        tests:
          - relationships:
              to: ref('特記コード')
              field: コード
      - name: 体型総合３
        tests:
          - relationships:
              to: ref('特記コード')
              field: コード
      - name: 馬特記１
        tests:
          - relationships:
              to: ref('特記コード')
              field: コード
      - name: 馬特記２
        tests:
          - relationships:
              to: ref('特記コード')
              field: コード
      - name: 馬特記３
        tests:
          - relationships:
              to: ref('特記コード')
              field: コード
      - name: 展開参考データ_馬スタート指数
      - name: 展開参考データ_馬出遅率

      # このフィールドの意味/形式が分からない
      - name: 展開参考データ_参考前走

      # todo: relationship with 騎手 master
      - name: 展開参考データ_参考前走騎手コード

      - name: 万券指数

      # この印は印コードとリンクする？（1-8が格納されている）
      - name: 万券印

      # このフィールドは19'以降全部「0:通常」になっているので使わない方が良さそう
      - name: 降級フラグ
        tests:
          - accepted_values:
              values: [0, 1, 2]

      - name: 激走タイプ
        tests:
          - accepted_values:
              values: [A1, A2, A3, A4, B1, B2]
      - name: 休養理由分類コード
        tests:
          - relationships:
              to: ref('休養理由分類コード')
              field: code
      - name: 芝ダ障害フラグ
        tests:
          - accepted_values:
              values: [0, 1, 2]
      - name: 距離フラグ
        tests:
          - accepted_values:
              values: [0, 1]
      - name: クラスフラグ
        tests:
          - accepted_values:
              values: [0, 1, 2, 3]
      - name: 転厩フラグ
        tests:
          - accepted_values:
              values: [0, 1, 2, 3]
      - name: 去勢フラグ
        tests:
          - accepted_values:
              values: [0, 1, 2, 3]
      - name: 乗替フラグ
        tests:
          - accepted_values:
              values: [0, 1, 9]

      # just contains blank space
      - name: 予備フラグ

      - name: 入厩何走目
      - name: 入厩年月日
      - name: 入厩何日前
      - name: 放牧先
      - name: 放牧先ランク
        tests:
          - accepted_values:
              values: [A, B, C, D, E]
      - name: 厩舎ランク
        tests:
          - accepted_values:
              values: [1, 2, 3, 4, 5, 6, 7, 8, 9]

  - name: stg_jrdb__tyb
    columns:
      # derived
      - name: レースキー
        tests:
          - not_null
      - name: 開催キー
        tests:
          - not_null
      # original
      - name: レースキー_場コード
        tests:
          - not_null
          - relationships:
              to: ref('場コード')
              field: code
      - name: レースキー_年
        tests:
          - not_null
      - name: レースキー_回
        tests:
          - not_null
      - name: レースキー_日
        tests:
          - not_null
      - name: レースキー_Ｒ
        tests:
          - not_null
      - name: 馬番
        tests:
          - not_null
      - name: ＩＤＭ
        tests:
          - not_null
      - name: 騎手指数
        tests:
          - not_null
      - name: 情報指数
        tests:
          - not_null
      - name: オッズ指数
        tests:
          - not_null
      - name: パドック指数
        tests:
          - not_null
      - name: 予備１
      - name: 総合指数
        tests:
          - not_null
      - name: 馬具変更情報
        tests:
          - not_null
          - accepted_values:
              values: [0, 1, 2]
      - name: 脚元情報
        tests:
          - not_null
          - accepted_values:
              values: [0, 1, 2, 3]
        description: |
          0:平行線
          1:良化（!）
          2:疑問（?）
          3:悪化（X）
      - name: 取消フラグ
        description: 取消フラグ
        tests:
          - not_null

      # todo: link with 騎手 master
      - name: 騎手コード
        tests:
          - not_null

      - name: 騎手名
        tests:
          - not_null
      - name: 負担重量
        description: 0.1Kg単位
        tests:
          - not_null
      - name: 見習い区分
        description: 1:☆(1K減),2:△(2K減),3:▲(3K減)
        tests:
          - not_null
          - accepted_values:
              values: [0, 1, 2, 3]
      - name: 馬場状態コード
        tests:
          - not_null
          - relationships:
              to: ref('馬場状態コード')
              field: code
      - name: 天候コード
        tests:
          - not_null
          - relationships:
              to: ref('天候コード')
              field: code

      # there are only 14 rows of null records (from 1999)
      - name: 単勝オッズ
      - name: 複勝オッズ
      - name: オッズ取得時間

      - name: 馬体重
      - name: 馬体重増減
      - name: オッズ印
        tests:
          - relationships:
              to: ref('印コード')
              field: code
      - name: パドック印
        tests:
          - relationships:
              to: ref('印コード')
              field: code
      - name: 直前総合印
        tests:
          - relationships:
              to: ref('印コード')
              field: code
      - name: 馬体コード
        tests:
          - relationships:
              to: ref('馬体コード')
              field: code
      - name: 気配コード
        tests:
          - relationships:
              to: ref('気配コード')
              field: code

      # todo: handle invalid times like 9:90
      # - name: 発走時間
